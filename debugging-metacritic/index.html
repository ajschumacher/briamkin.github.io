
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Metacritic Debugging</title>
    <meta name="description" content="Metacritic is a great site but has some incredibly annoying bugs that needed to be debugged so I could scrape it properly!">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="57x57" href="../assets/favicon/apple-touch-icon-57x57.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="60x60" href="../assets/favicon/apple-touch-icon-60x60.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/favicon/apple-touch-icon-72x72.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/favicon/apple-touch-icon-76x76.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/favicon/apple-touch-icon-114x114.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="120x120" href="../assets/favicon/apple-touch-icon-120x120.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="144x144" href="../assets/favicon/apple-touch-icon-144x144.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/favicon/apple-touch-icon-152x152.png?v=4a16edf9d0">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon-180x180.png?v=4a16edf9d0">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-32x32.png?v=4a16edf9d0">
    <link rel="icon" type="image/png" href="../assets/favicon/android-chrome-192x192.png?v=4a16edf9d0">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-96x96.png?v=4a16edf9d0">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-16x16.png?v=4a16edf9d0">
    <link rel="manifest" href="../assets/favicon/manifest.json?v=4a16edf9d0">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/assets/favicon/mstile-144x144.png?v=4a16edf9d0">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=4a16edf9d0">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic%7COpen+Sans:700,400">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-62074703-1', 'auto');
      ga('send', 'pageview');

    </script>
    <link rel="canonical" href="http://briank.im/debugging-metacritic/">
    
    <meta property="og:site_name" content="loving learning">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Metacritic Debugging">
    <meta property="og:description" content="Metacritic is a great site but has some incredibly annoying bugs that needed to be debugged so I could scrape it properly!...">
    <meta property="og:url" content="http://briank.im/debugging-metacritic/">
    <meta property="article:published_time" content="2015-04-19T21:53:32.169Z">
    <meta property="article:modified_time" content="2015-04-20T03:48:47.511Z">
    <meta property="article:tag" content="projects">
    <meta property="article:tag" content="luther">
    <meta property="article:tag" content="tutorial">
    <meta property="article:tag" content="debugging">
    <meta property="article:tag" content="metacritic">
    <meta property="article:tag" content="redirects">
    <meta property="article:tag" content="pagination">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Metacritic Debugging">
    <meta name="twitter:description" content="Metacritic is a great site but has some incredibly annoying bugs that needed to be debugged so I could scrape it properly!...">
    <meta name="twitter:url" content="http://briank.im/debugging-metacritic/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "loving learning",
    "author": {
        "@type": "Person",
        "name": "bk",
        "image": "http://briank.im/content/images/2015/04/profile.jpg",
        "url": "http://briank.im/author/bk",
        "sameAs": ""
    },
    "headline": "Metacritic Debugging",
    "url": "http://briank.im/debugging-metacritic/",
    "datePublished": "2015-04-19T21:53:32.169Z",
    "dateModified": "2015-04-20T03:48:47.511Z",
    "keywords": "projects, luther, tutorial, debugging, metacritic, redirects, pagination",
    "description": "Metacritic is a great site but has some incredibly annoying bugs that needed to be debugged so I could scrape it properly!..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="loving learning" href="http://briank.im/rss/">
</head>
<body class="post-template tag-projects tag-luther tag-tutorial tag-debugging tag-metacritic tag-redirects tag-pagination">

	<header id="site-head">
		<div class="vertical">
			<div id="site-head-content" class="inner">

				<a id="blog-logo" href="http://briank.im"><img src="../content/images/2015/04/bk_logo-150.png" alt="Blog Logo"></a>
				<h1 class="blog-title">loving learning</h1>
				<h2 class="blog-description">a journey to learn as much as i can</h2>
				    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/">Home</a></h3>
    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/about/">About</a></h3>
    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/tag/tutorial/">Learn</a></h3>

			</div>
		</div>
	</header>

    

<main class="content" role="main">

    <article class="post tag-projects tag-luther tag-tutorial tag-debugging tag-metacritic tag-redirects tag-pagination">




        <span class="post-meta"><time datetime="2015-04-19">19 Apr 2015</time> on <a href="../tag/projects/">projects</a> | <a href="../tag/luther/">luther</a> | <a href="../tag/tutorial/">tutorial</a> | <a href="../tag/debugging/">debugging</a> | <a href="../tag/metacritic/">metacritic</a> | <a href="../tag/redirects/">redirects</a> | <a href="../tag/pagination/">pagination</a></span>

        <h1 class="post-title">Debugging Metacritic</h1>

        <section class="post-content" id="jetzt-container">
            <h4 id="metacriticwhyyyy">Metacritic, whyyyy?</h4>

<p><img src="../content/images/2015/04/metacritic-logo.png" alt="Metacritic">
In this entry I'm going to talk about 2 major issues that came up while scraping data from metacritic.com, which is now the most important data source for my Luther Project. The 2 major issues involved <b>TERRIBLE</b> pagination issues and <b>annoying</b> redirects.</p>

<p>Let's start with the pagination issues: <br>
<img src="../content/images/2015/04/Screen-Shot-2015-04-19-at-5-25-36-PM.png" alt="Metacritic Pagination"></p>

<h5 id="whatispagination">What is Pagination?</h5>

<p>Pagination is simply when the content doesn't fit on one page so a website adds those annoying links at the bottom for the next pages. However, this has been replaced on some sites by infinite loading scripts.  </p>

<h5 id="whysobadonmetacritic">Why so bad on metacritic?</h5>

<p>Go to a page like <a href="http://www.metacritic.com/critic/ao-scott?filter=movies&amp;num_items=100&amp;sort_options=critic_score">this</a>. Everything seems okay. And even the first 6 pagination links work fine. But get to the <a href="http://www.metacritic.com/critic/ao-scott?filter=movies&amp;num_items=100&amp;sort_options=critic_score&amp;page=6">7th one</a> and you'll notice something weird. This one has 300 entries, not 100! And even weirder, pages 8 and 9 have the exact same lists! What's even weirder is that if you're using the default sorting by critic score, even this weird pagination issue is inconsistent! So how to solve this?</p>

<h5 id="solution">Solution</h5>

<p>The solution has a few components to it. Basically I found out that when you sort it by Metascore, the issue still comes up, but it is at least consistent throughout, starting from page 7 and onward.  </p>

<pre><code>  skip = 0
  for num in range(0, (int(pagination))):
      if skip &lt; 1 or skip == 3:
          new_reviews = get_reviews_by_critic(slug, num)
          reviews += new_reviews
          if len(new_reviews) &gt; 100:
              skip = 1
      else:
          skip += 1
</code></pre>

<p>Basically this script first detects if there are more than the 100 entries. If there are, it adds a skip. And it will then skip the next 2 pages. And then start again in 3 pages.</p>

<p><img src="../content/images/2015/04/website_redirection.jpg" alt="URL Redirect"></p>

<h5 id="whatisaredirect">What is a redirect</h5>

<p>Basically, sometimes a link has moved or a url has been changed, so the site will redirect you to the correct url if you go to the right one. On Metacritic, for example, there may be a link to this: (<a href="http://www.metacritic.com/movie/twelve-years-a-slave">http://www.metacritic.com/movie/twelve-years-a-slave</a>) but when you click on it, it will redirect to this: (<a href="http://www.metacritic.com/movie/12-years-a-slave">http://www.metacritic.com/movie/12-years-a-slave</a>). This presents a bit of a problem for scraping because the scraper wants to scrape the first site but doesn't get anything back because of the redirect.</p>

<h5 id="solution">Solution</h5>

<pre><code>try:  
    movie_doc = just_get_html(movie_url)

except:  
    movie_url = "http://www.metacritic.com/movie/" + review_dict['movie_slug']
    request = urllib2.Request(movie_url)
    request.add_header('User-Agent', req_header)
    opener = urllib2.build_opener()
    f = opener.open(request)
    movie_doc = just_get_html(f.url)
</code></pre>

<p>Basically, I am importing and using the requests module from Python. If the regular url doesn't exist, then it tries to find the redirect. And then it uses the new redirected page url to scrape. Simple. <br>
<br>  </p>

<h5 id="whatilearnedtoday">What I Learned Today:</h5>

<pre><code>Lefteris Greek restaurant in Tarrytown, NY is AMAZING! The Gyro Platter is to die for.  
</code></pre>
        </section>

        <footer class="post-footer">

                <section class="author">
                    <h4>bk</h4>
                    <p>There are three things I love in this life: learning, efficiency and my wife, not necessarily in that order</p>
                </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Debugging%20Metacritic&amp;url=http://briank.im/debugging-metacritic/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://briank.im/debugging-metacritic/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://briank.im/debugging-metacritic/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
			<!--<div id="disqus_thread"></div>-->
    <script type="text/javascript">
//        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
//        var disqus_shortname = '[your forum shortname]'; // required: replace example with your forum shortname
//
//        /* * * DON'T EDIT BELOW THIS LINE * * */
//        (function() {
//            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
//            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
//            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
//        })();
    </script>
    <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
    <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
        </footer>


    </article>

</main>



    <script src="../public/jquery.js?v=4a16edf9d0"></script>

    <script type="text/javascript" src="../assets/js/index.js?v=4a16edf9d0"></script>

</body>
