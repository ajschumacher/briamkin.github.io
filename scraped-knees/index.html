
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Scraping can have many problems</title>
    <meta name="description" content="Debugging in python is not very difficult. One way is to log errors. This lets you easily see what went wrong and what went right.">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="57x57" href="../assets/favicon/apple-touch-icon-57x57.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="60x60" href="../assets/favicon/apple-touch-icon-60x60.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/favicon/apple-touch-icon-72x72.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/favicon/apple-touch-icon-76x76.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/favicon/apple-touch-icon-114x114.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="120x120" href="../assets/favicon/apple-touch-icon-120x120.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="144x144" href="../assets/favicon/apple-touch-icon-144x144.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/favicon/apple-touch-icon-152x152.png?v=d9145c7f8e">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon-180x180.png?v=d9145c7f8e">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-32x32.png?v=d9145c7f8e">
    <link rel="icon" type="image/png" href="../assets/favicon/android-chrome-192x192.png?v=d9145c7f8e">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-96x96.png?v=d9145c7f8e">
    <link rel="icon" type="image/png" href="../assets/favicon/favicon-16x16.png?v=d9145c7f8e">
    <link rel="manifest" href="../assets/favicon/manifest.json?v=d9145c7f8e">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/assets/favicon/mstile-144x144.png?v=d9145c7f8e">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=d9145c7f8e">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic%7COpen+Sans:700,400">
    <link rel="stylesheet" type="text/css" href="../assets/css/prism.css?v=d9145c7f8e">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-62074703-1', 'auto');
      ga('send', 'pageview');

    </script>
    <link rel="canonical" href="http://briank.im/scraped-knees/">
    
    <meta property="og:site_name" content="loving learning">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Scraping can have many problems">
    <meta property="og:description" content="Debugging in python is not very difficult. One way is to log errors. This lets you easily see what went wrong and what went right....">
    <meta property="og:url" content="http://briank.im/scraped-knees/">
    <meta property="og:image" content="http://briank.im/content/images/2015/04/bandaid-knee.jpg">
    <meta property="article:published_time" content="2015-04-17T00:32:00.000Z">
    <meta property="article:modified_time" content="2015-04-30T18:08:32.073Z">
    <meta property="article:tag" content="beautifulsoup">
    <meta property="article:tag" content="luther">
    <meta property="article:tag" content="tutorial">
    <meta property="article:tag" content="pickle">
    <meta property="article:tag" content="logging">
    <meta property="article:tag" content="debugging">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Scraping can have many problems">
    <meta name="twitter:description" content="Debugging in python is not very difficult. One way is to log errors. This lets you easily see what went wrong and what went right....">
    <meta name="twitter:url" content="http://briank.im/scraped-knees/">
    <meta name="twitter:image:src" content="http://briank.im/content/images/2015/04/bandaid-knee.jpg">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "loving learning",
    "author": {
        "@type": "Person",
        "name": "bk",
        "image": "http://briank.im/content/images/2015/04/profile.jpg",
        "url": "http://briank.im/author/bk",
        "sameAs": ""
    },
    "headline": "Scraping can have many problems",
    "url": "http://briank.im/scraped-knees/",
    "datePublished": "2015-04-17T00:32:00.000Z",
    "dateModified": "2015-04-30T18:08:32.073Z",
    "image": "http://briank.im/content/images/2015/04/bandaid-knee.jpg",
    "keywords": "beautifulsoup, luther, tutorial, pickle, logging, debugging",
    "description": "Debugging in python is not very difficult. One way is to log errors. This lets you easily see what went wrong and what went right...."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="loving learning" href="http://briank.im/rss/">
</head>
<body class="post-template tag-beautifulsoup tag-luther tag-tutorial tag-pickle tag-logging tag-debugging">

	<header id="site-head" style="background-image: url(../content/images/2015/04/bandaid-knee.jpg)">
		<div class="vertical">
			<div id="site-head-content" class="inner">

				<a id="blog-logo" href="http://briank.im"><img src="../content/images/2015/04/bk_logo-150.png" alt="Blog Logo"></a>
				<h1 class="blog-title">loving learning</h1>
				<h2 class="blog-description">a journey to learn as much as i can</h2>
				    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/tag/project-write-ups/">Projects</a></h3>
    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/tag/tutorial/">Learn</a></h3>
    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/about/">About</a></h3>
    <h3 class="blog-nav-item"><a class="header-link" href="http://briank.im/contact/">Contact</a></h3>

			</div>
		</div>
	</header>

    

<main class="content" role="main">

    <article class="post tag-beautifulsoup tag-luther tag-tutorial tag-pickle tag-logging tag-debugging">




        <span class="post-meta"><time datetime="2015-04-16">16 Apr 2015</time> on <a href="../tag/beautifulsoup/">beautifulsoup</a> | <a href="../tag/luther/">luther</a> | <a href="../tag/tutorial/">tutorial</a> | <a href="../tag/pickle/">pickle</a> | <a href="../tag/logging/">logging</a> | <a href="../tag/debugging/">debugging</a></span>

        <h1 class="post-title">Scraped Knees, Logging Helps</h1>

        <section class="post-content" id="jetzt-container">
            <h4 id="scrapingproblems">Scraping Problems</h4>

<p><img src="../content/images/2015/04/bandaid-knee.jpg" alt="Scraped Knees"></p>

<p><a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> for Python is a great tool for scraping but that doesn't necessarily mean everything is easy. Scraping is all about the unknown. And one of the golden rules is that you can't trust the page you're trying to scrape. You can't trust that it's telling you the truth.</p>

<p>For example, the site I'm trying to scrape for my 2nd major project at Metis is <a href="http://www.metacritic.com">metacritic.com</a>. As I was trying to scrape the list of critics, I went to <a href="http://www.metacritic.com/browse/movies/critic/score?num_items=100">http://www.metacritic.com/browse/movies/critic/score?num_items=100</a> and attempted to scrape 100 artists per page. I scraped it through a loop for the 8 pages there, expecting between 700 and 800 artists. But for some reason I kept on getting around 600 with no errors anywhere to be found! I tried over and over again with little changes hoping that I could solve the mystery. But, after about an hour, I finally realized that maybe I was right. Crazy, right?? Well, I found out that my scraper was scraping between 73 and 88 critics for each page, not 100. So I manually counted one of the pages and found out that it wasn't actually 100. D'OH! <br>
<img src="../content/images/2015/04/homer-simpson-doh-400x288.jpg" alt=""></p>

<p>Anyways, that is only one of many examples of something stupid I have done. Now, aside from this, I had many problems that I've since learned from. I'm going to share some really simple solutions to some pretty elementary problems that one might encounter when first learning to scrape. If you're already an expert, you can probably skip all this!</p>

<h5 id="problem1rescrapingmultipletimes">Problem 1: Rescraping Multiple Times</h5>

<p>The first problem was having to rescrape the same data each time I wanted to rerun a function. This was easily solved with Pickle, which I wrote about in <a href="http://briank.im/in-a-pickle/">this</a> blog entry.</p>

<h5 id="problem2waitingforascraperforhours">Problem 2: Waiting For a Scraper for Hours</h5>

<p>Sometimes this is necessary. But what's not cool is when you scrape some data from a site for 3+ hours only to have an error at the end stop you from saving the data through Pickle. So what I have done since, to prevent this from happening is to Pickle multiple times.  </p>

<pre><code class="language-python">count = 1  
for critic in critic_list:  
    review = metacritic.get_all_reviews_by_critic(critic)
    with open('nytimes_review_list' + str(count) + '.pkl', 'w') as f:
        pickle.dump(review, f)
    count += 1
</code></pre>

<p>In my sample code here, instead of waiting to Pickle after all the scraping is done, I have my loop here create a new Pickle file for each critic. This way, even if it craps out at the end, I still have a lot of data that I can use. </p>

<p>Of course doing a good job with Python's "Try" and "Except" methods may also prevent this!</p>

<h5 id="problem3losingdatabecauseofanerror">Problem 3: Losing Data Because of an Error</h5>

<p>This can happen for a multitude of reasons. So one way to prevent a function from stopping because of an error is to use "Try" and "Except" in Python. The logic goes something like this: If there is an error in a "try" block, then it will move on to the "except" statement. It operates just like an if/else statement.  </p>

<pre><code class="language-python">reviews = []  
try:  
    pagination = soup.find(class_='last_page').a.text
    for num in range(0, (int(pagination))):
        reviews += get_reviews_by_critic(slug, num)
except  
    try:
        reviews += get_reviews_by_critic(slug, 0)
    except:
        pass
</code></pre>

<p>In this sample code, the program will search for the class 'last_page'. Now if this were in an 'if' statement, then an error would be called and the program would stop and you would lose everything. But with the try statement, if there is an error, now it will go onto the 'except' statement. In the excitement, I put another try statement that follows the same logic, and if that one fails too, then it will just pass. Now, the problem with this is that we don't know why it passed! So to get a little bit more info, we're going to set up logging.</p>

<p>I think the easiest way to set up logging is to write it into a separate log file. It really isn't very difficult. All you need is this:  </p>

<pre><code class="language-python">import logging  
logging.basicConfig(filename='debug.log', level=logging.DEBUG)  
</code></pre>

<p>This code will import in the logging module and then set the log file to 'debug.log' in the same directory as your program. Though of course you can change it to whatever path you want. Then we have to call it in the actual code.  </p>

<pre><code class="language-python">reviews = []  
try:  
    pagination = soup.find(class_='last_page').a.text
    for num in range(0, (int(pagination))):
        reviews += get_reviews_by_critic(slug, num)
except  
    try:

        reviews += get_reviews_by_critic(slug, 0)
    except Exception, e:
        logging.exception(e)
</code></pre>

<h5 id="problem4myprogramhasbeenscrapingforhoursandineedtogohome">Problem 4: My Program Has Been Scraping for Hours, and I Need To Go Home...</h5>

<p>Now, logging is not only for debugging, it can also be for giving you a little bit more information about the process. One of the things I found most annoying about scraping is that you often don't know how far along in the process you are. So I started logging multiple times during a program so I would know how far along it was and how much time was left.  </p>

<pre><code class="language-python">import datetime  
reviews = []  
try:  
    pagination = soup.find(class_='last_page').a.text
    logging.debug('[' + datetime.datetime.now().strftime("%a-%m-%d %I:%M:%S") + '] Found ' + pagination + ' pages to scrape')
    for num in range(0, (int(pagination))):
        reviews += get_reviews_by_critic(slug, num)
except  
    try:
        logging.debug('[' + datetime.datetime.now().strftime("%a-%m-%d %I:%M:%S") + '] Only found 1 page to scrape')
        reviews += get_reviews_by_critic(slug, 0)
    except Exception, e:
        logging.exception(e)
</code></pre>

<p>Adding in the timestamp with debugging now gives me not just more info, but also some idea of how long certain calls took! <br>
<br>  </p>

<h5 id="whatilearnedtoday">What I Learned Today:</h5>

<pre><code>Python makes it incredibly easy to log errors.  
</code></pre>
        </section>

        <footer class="post-footer">

                <section class="author">
                    <h4>bk</h4>
                    <p>There are three things I love in this life: learning, efficiency and my wife, not necessarily in that order</p>
                </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Scraped%20Knees,%20Logging%20Helps&amp;url=http://briank.im/scraped-knees/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://briank.im/scraped-knees/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://briank.im/scraped-knees/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
			<!--<div id="disqus_thread"></div>-->
    <script type="text/javascript">
//        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
//        var disqus_shortname = '[your forum shortname]'; // required: replace example with your forum shortname
//
//        /* * * DON'T EDIT BELOW THIS LINE * * */
//        (function() {
//            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
//            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
//            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
//        })();
    </script>
    <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
    <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
        </footer>


    </article>

</main>



    <script src="../public/jquery.js?v=d9145c7f8e"></script>

    <script type="text/javascript" src="../assets/js/index.js?v=d9145c7f8e"></script>
    <script type="text/javascript" src="../assets/js/prism.js?v=d9145c7f8e"></script>
</body>
